# Домашняя работа № 3. Установка и настройка PostgreSQL.

### создать ВМ с Ubuntu 20.04/22.04 или развернуть докер любым удобным способом
> Я создал виртуальную машину с Ubuntu 22.04.1 LTS в Яндексе. Назвал ее ubuntu2204-vm2. Скрин виртуальной машине Яндекса на картинке ниже:
> <image src="images/vm_yandex.png" alt="vm_yandex">

### Поставьте на нее PostgreSQL 14 через sudo apt. Проверьте что кластер запущен через sudo -u postgres pg_lsclusters
> Т.к. версия Ubuntu 22.04, устанавливаю PostgreSQL так (знаю, что установится 14-я версия):
> ```sh
> aleksandr@ubuntu2204-vm2:~$ sudo apt-get -y install postgresql
> ```
> Результат:
> 
> <image src="images/postgres_cluster.png" alt="postgres_cluster">

### Зайдите из под пользователя postgres в psql и сделайте произвольную таблицу с произвольным содержимым
> ```sh
> postgres=# create table test(c1 text);
> postgres=# insert into test values('1');
> \q
> ```
> Результат:
> 
> <image src="images/res_table_create.png" alt="res_table_create">

### Остановите postgres например через sudo -u postgres pg_ctlcluster 14 main stop
> ```sh
> aleksandr@ubuntu2204-vm2:~$ sudo -u postgres pg_ctlcluster 14 main stop
> ```
> Результат:
> 
> <image src="images/stop_cluster.png" alt="stop_cluster">

### Создайте новый standard persistent диск GKE через Compute Engine -> Disks в том же регионе и зоне что GCE инстанс размером например 10GB. Добавьте свеже-созданный диск к виртуальной машине - надо зайти в режим ее редактирования и дальше выбрать пункт attach existing disk
> Создал диск, добавил к виртуальной машине
> 
> Результат:
> 
> <image src="images/disk2.png" alt="disk2">

> В виртуалке этот новый диск, обозначен как "vdb":
> 
> ```sh
> aleksandr@ubuntu2204-vm2:~$ sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT,LABEL
> ```
>
> <image src="images/disk2_vm.png" alt="disk2_vm">

### Проинициализируйте диск согласно инструкции и подмонтировать файловую систему, только не забывайте менять имя диска на актуальное, в вашем случае это скорее всего будет /dev/sdb - https://www.digitalocean.com/community/tutorials/how-to-partition-and-format-storage-devices-in-linux

### перезагрузите инстанс и убедитесь, что диск остается примонтированным (если не так смотрим в сторону fstab)

### сделайте пользователя postgres владельцем /mnt/data - chown -R postgres:postgres /mnt/data/

### перенесите содержимое /var/lib/postgres/14 в /mnt/data - mv /var/lib/postgresql/14 /mnt/data

### попытайтесь запустить кластер - sudo -u postgres pg_ctlcluster 14 main start

### напишите получилось или нет и почему

### задание: найти конфигурационный параметр в файлах раположенных в /etc/postgresql/14/main который надо поменять и поменяйте его

### напишите что и почему поменяли

### попытайтесь запустить кластер - sudo -u postgres pg_ctlcluster 14 main start

### напишите получилось или нет и почему

### зайдите через через psql и проверьте содержимое ранее созданной таблицы

задание со звездочкой *: не удаляя существующий инстанс ВМ сделайте новый, поставьте на его PostgreSQL, удалите файлы с данными из /var/lib/postgres, перемонтируйте внешний диск который сделали ранее от первой виртуальной машины ко второй и запустите PostgreSQL на второй машине так чтобы он работал с данными на внешнем диске, расскажите как вы это сделали и что в итоге получилось.