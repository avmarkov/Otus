# Домашняя работа № 4. Работа с базами данных, пользователями и правами

### 1. Cоздайте новый кластер PostgresSQL 14
> Я создал виртуальную машину с Ubuntu 22.04.1 LTS в Яндексе. Назвал ее ubuntu2204-vm3. Скрин виртуальной машине Яндекса на картинке ниже:
> <image src="images/vm_yandex.png" alt="vm_yandex">
>
> Т.к. версия Ubuntu 22.04, устанавливаю PostgreSQL так (знаю, что установится 14-я версия):
> ```sh
> aleksandr@ubuntu2204-vm3:~$ sudo apt-get -y install postgresql
> ```
> Кластер создался:
> 
> <image src="images/pg_cluster.png" alt="pg_cluster">
### 2. Зайдите в созданный кластер под пользователем postgres
> Зашел:
> ```sh
> aleksandr@ubuntu2204-vm3:~$ sudo -u postgres psql
> ```
> <image src="images/postgres.png" alt="postgres">

### 3. Cоздайте новую базу данных testdb
> ```sh
> postgres=# CREATE DATABASE testdb;
> ```

### 4. Зайдите в созданную базу данных под пользователем postgres
> ```sh
> postgres=# \c testdb
> ```

### 5. Создайте новую схему testnm
> ```sh
> testdb=# CREATE SCHEMA testnm;
> ```

### 6. Создайте новую таблицу t1 с одной колонкой c1 типа integer
> ```sh
> testdb=# CREATE TABLE t1(c1 integer);
> ```

### 7. Вставьте строку со значением c1=1
> ```sh
> testdb=# INSERT INTO t1 VALUES(1);
> ```

### 8. Создайте новую роль readonly
> ```sh
> testdb=# CREATE ROLE readonly;
> ```

### 9. Дайте новой роли право на подключение к базе данных testdb
> ```sh
> testdb=# GRANT CONNECT ON DATABASE testdb TO readonly;
> ```

### 10. Дайте новой роли право на использование схемы testnm
> ```sh
> testdb=# GRANT USAGE ON SCHEMA testnm to readonly;
> ```

### 11. Дайте новой роли право на select для всех таблиц схемы testnm
> ```sh
> testdb=# GRANT SELECT ON ALL TABLES IN SCHEMA testnm TO readonly;
> ```

### 12. Создайте пользователя testread с паролем test123
> ```sh
> testdb=# CREATE USER testread WITH password 'test123';
> ```

### 13. дайте роль readonly пользователю testread
> ```sh
> testdb=# GRANT readonly TO testread;
> ```

### 14. зайдите под пользователем testread в базу данных testdb
> ```sh
> testdb=# \c testdb testread
>```
> Подключиться не получилось. Результат:
>
> <image src="images/user_testread.png" alt="user_testread">

> Подключиться так получилось:
> ```sh
> aleksandr@ubuntu2204-vm3:~$ psql -h localhost -U testread -d testdb -W
>```

### 15. Cделайте select * from t1;
> Сделал
> ```sh
> testdb=> select * from t1;
>```

### 16. Получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)
> Не получилось
>
> <image src="images/sel_res.png" alt="sel_res">

### 17. Напишите что именно произошло в тексте домашнего задания
> Мы создали таблицу t1. Создали схему testnm. Создали роль readonly, дали этой роли права на подключение к базе данных testdb,
> на использование схемы testnm, на select для всех таблиц схемы testnm. Затем создали пользователя testread и дали ему роль readonly.

### 18. у вас есть идеи почему? ведь права то дали?
> Не получилось, т.к. таблица t1 принадлежит схеме public. А права роли readonly мы дали для схемы testnm, поэтому к схеме public нет доступа.

### 19. посмотрите на список таблиц

### 20. подсказка в шпаргалке под пунктом 20

### 21. а почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)

### 22. вернитесь в базу данных testdb под пользователем postgres

### 23. удалите таблицу t1

### 24. создайте ее заново но уже с явным указанием имени схемы testnm

### 25. вставьте строку со значением c1=1

### 26. зайдите под пользователем testread в базу данных testdb

### 27. сделайте select * from testnm.t1;

### 28. получилось?

### 29. есть идеи почему? если нет - смотрите шпаргалку

### 30. как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку

### 31. сделайте select * from testnm.t1;

### 32 получилось?

### 33. есть идеи почему? если нет - смотрите шпаргалку

### 31. сделайте select * from testnm.t1;

### 32. получилось?

### 33. ура!

### 34. теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);

### 35. а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?

### 36. есть идеи как убрать эти права? если нет - смотрите шпаргалку

### 37. если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды

### 38. теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);

### 39. расскажите что получилось и почему